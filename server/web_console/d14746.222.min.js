(window.webpackJsonp=window.webpackJsonp||[]).push([[222,490],{1557:function(e,t,r){e.exports={"util-container":"util-container-6c7bd97c63"}},545:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r.n(a),i=(r(224),r(97)),l=(r(803),r(227)),u=(r(299),r(165)),c=r(50),o=r.n(c),s=r(28),m=r.n(s),_=r(16),d=r.n(_),b=r(0),g=r.n(b),v=r(55),N=r(599),f=r(794),p=r(115),j=r.n(p),O=r(70),x=r.n(O),h=r(1767),w=r(596),k=r(1616),E=r(1757),I=r(1637),y=r(1613),C=r(1615),P=r(1628),S=r(1768),R=r(1621),z=r(54),F=r(12),D=function(e){var t=e.data,r=e.params;return Object(z.b)({method:"post",url:"/api/v6/kube/threatres/list",data:t,params:r},Object(F.g)("获取威胁资源列表"))};var L=r(1625),M=r(1624),U=r(1557),A=r.n(U),B="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/pages/threatres-list/index.tsx",Y=j.a.bind(A.a),G={critical:"#E63F3F",high:"#846BCE",medium:"#FEC746",low:"#468DFF"},T={critical:Object(F.g)("紧急"),high:Object(F.g)("高风险"),medium:Object(F.g)("中风险"),low:Object(F.g)("低风险")};t.default=function(e){var t,r,a=e.clusterId,c=e.visible,s=void 0===c||c,_=Object(v.g)(),p=!!a,j={cluster_name:void 0,region:void 0,risk_name_list:{value:[],adapter:M.b.stringArray,isFilter:!0},risk_level_list:{value:[],adapter:M.b.stringArray,isFilter:!0},source_ip:void 0,user_agent:void 0,user:void 0,user_group:void 0,source_psm:void 0,create_time_start:void 0,create_time_end:void 0,resource_kind:void 0,resource_namespace:void 0,resource_name:void 0,image_name:void 0,read_only_mount:void 0,read_write_mount:void 0,cluster_id:void 0,current:{value:1,adapter:M.b.number,isCurrent:!0},pageSize:{value:10,adapter:M.b.number,isPageSize:!0}},O=Object(M.a)({initParams:j,namespace:p?L.a.threatresList:void 0,autoMergeUrlParams:!0,visible:s}),U=O.globalUrlParams,A=O.setGlobalUrlParams,W=O.tablePropsProxy,H=Object(N.a)(m()(d.a.mark((function e(){var t,r,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D({params:{page_size:U.pageSize,page:U.current},data:{condition:{cluster_name:U.cluster_name,region:U.region,risk_name_list:U.risk_name_list,risk_level_list:U.risk_level_list,source_ip:U.source_ip,user_agent:U.user_agent,user:U.user,user_group:U.user_group,source_psm:U.source_psm,create_time_start:U.create_time_start?Number(U.create_time_start):void 0,create_time_end:U.create_time_end?Number(U.create_time_end):void 0,resource_kind:U.resource_kind,resource_namespace:U.resource_namespace,resource_name:U.resource_name,image_name:U.image_name,read_only_mount:U.read_only_mount,read_write_mount:U.read_write_mount,cluster_id:a}}});case 2:return t=e.sent,r=t.data,n=t.page_info,e.abrupt("return",{list:r,total:(null==n?void 0:n.total)||0});case 6:case"end":return e.stop()}}),e)}))),{debounceInterval:300,onChangeDeps:[Object(f.a)(U)],defaultParams:[{pageSize:U.pageSize,current:U.current,filters:{risk_name_list:null!==(t=U.risk_name_list)&&void 0!==t?t:[],risk_level_list:null!==(r=U.risk_level_list)&&void 0!==r?r:[]}}]}),J=H.tableProps,V=H.refresh,K=Object(b.useState)(!1),X=o()(K,2),q=X[0],Q=X[1],Z=Object(b.useState)(null),$=o()(Z,2),ee=$[0],te=$[1],re=function(){var e=m()(d.a.mark((function e(t){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Q(!0),e.next=3,n={threatres_id:t},Object(z.b)({url:"/api/v6/kube/threatres/raw",method:"GET",params:n},Object(F.g)("获取威胁资源原始数据"));case 3:r=e.sent,a=r.data,te(a);case 6:case"end":return e.stop()}var n}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=[{title:Object(F.g)("集群"),dataIndex:"cluster_name",fixed:"left",width:120,render:function(e,t){return e?g.a.createElement("div",{__source:{fileName:B,lineNumber:171,columnNumber:11}},g.a.createElement(u.a,{onClick:function(){_.push("/kube-detail?name=".concat(e,"&clusterId=").concat(t.cluster_id))},__source:{fileName:B,lineNumber:172,columnNumber:13}},e),g.a.createElement("div",{style:{color:"#4E5969",paddingLeft:4},__source:{fileName:B,lineNumber:179,columnNumber:13}},t.region)):g.a.createElement("div",{style:{marginLeft:4},__source:{fileName:B,lineNumber:182,columnNumber:11}},"-")}},{title:Object(F.g)("风险名称"),dataIndex:"risk_name_list",fixed:"left",filters:[{text:Object(F.g)("非预期镜像"),value:"unintend_image"},{text:Object(F.g)("挖矿镜像"),value:"miner_image"},{text:Object(F.g)("特权容器"),value:"privileged_container"},{text:Object(F.g)("特权 Capabilities"),value:"privileged_capabilities"},{text:Object(F.g)("共享宿主机命名空间"),value:"share_host_ns"},{text:Object(F.g)("挂载宿主机敏感文件"),value:"mount_sensitive_host_file"},{text:Object(F.g)("非预期的定时任务"),value:"unintend_cronjob"},{text:Object(F.g)("在 Master Node 部署 Workloads"),value:"deploy_on_masters"},{text:Object(F.g)("创建大权限 ClusterRole"),value:"create_powerful_clusterrole"},{text:Object(F.g)("创建大权限 Role"),value:"create_powerful_role"},{text:Object(F.g)("创建可部署工作负载的 ClusterRole"),value:"create_workloads_clusterrole"},{text:Object(F.g)("创建可部署工作负载的 Role"),value:"create_workloads_role"},{text:Object(F.g)("创建不安全的 ClusterRole"),value:"create_insecure_clusterrole"},{text:Object(F.g)("创建不安全的 ClusterRoleBinding"),value:"create_insecure_clusterrolebinding"},{text:Object(F.g)("创建不安全的 RoleBinding"),value:"create_insecure_rolebinding"},{text:Object(F.g)("创建 NodePort 类型的 Service"),value:"create_nodeport_service"},{text:Object(F.g)("创建未启用 SSL 的 Ingress"),value:"create_non_ssl_ingress"},{text:Object(F.g)("创建准入控制器"),value:"create_admission_webhook"},{text:Object(F.g)("创建不安全的 Dashboard"),value:"create_insecure_dashboard"}],filteredValue:U.risk_name_list,width:104,render:function(e,t){return t.risk_name?g.a.createElement(k.a,{content:t.risk_name,__source:{fileName:B,lineNumber:216,columnNumber:26}}):"-"}},{title:Object(F.g)("级别"),dataIndex:"risk_level_list",filters:[{text:Object(F.g)("紧急"),value:"critical"},{text:Object(F.g)("高风险"),value:"high"},{text:Object(F.g)("中风险"),value:"medium"},{text:Object(F.g)("低风险"),value:"low"}],filteredValue:U.risk_level_list,width:92,render:function(e,t){return t.risk_level?g.a.createElement(C.a,{color:G[t.risk_level],content:T[t.risk_level],__source:{fileName:B,lineNumber:231,columnNumber:11}}):"-"}},{title:Object(F.g)("来源"),dataIndex:"source_info",width:136,render:function(e,t){var r,a;return g.a.createElement("div",{__source:{fileName:B,lineNumber:244,columnNumber:9}},g.a.createElement(k.a,{content:null!==(r=t.source_info.ip)&&void 0!==r?r:"-",__source:{fileName:B,lineNumber:245,columnNumber:11}}),g.a.createElement(k.a,{content:null!==(a=t.source_info.psm)&&void 0!==a?a:"-",style:{color:"#4E5969"},__source:{fileName:B,lineNumber:246,columnNumber:11}}))}},{title:"UserAgent",dataIndex:"user_agent",width:120,render:function(e){return e?g.a.createElement(k.a,{content:e,__source:{fileName:B,lineNumber:254,columnNumber:39}}):"-"}},{title:Object(F.g)("用户"),dataIndex:"user",width:123,render:function(e){return e?g.a.createElement(k.a,{content:e,__source:{fileName:B,lineNumber:260,columnNumber:39}}):"-"}},{title:Object(F.g)("用户组"),dataIndex:"user_group_list",width:165,render:function(e,t){return t.user_group_list?g.a.createElement(E.a,{items:t.user_group_list,width:90,__source:{fileName:B,lineNumber:267,columnNumber:32}}):"-"}},{title:Object(F.g)("资源类型/命名空间"),dataIndex:"resource",width:144,render:function(e,t){var r,a;return g.a.createElement(l.a.Paragraph,{style:{margin:0},ellipsis:{rows:2,showTooltip:!0},__source:{fileName:B,lineNumber:274,columnNumber:9}},"".concat(null!==(r=t.resource_info.kind)&&void 0!==r?r:" - ","/").concat(null!==(a=t.resource_info.namespace)&&void 0!==a?a:" - "))}},{title:Object(F.g)("资源名称"),dataIndex:"resource_info.name",width:180,render:function(e){return g.a.createElement(l.a.Paragraph,{style:{margin:0},ellipsis:{rows:2,showTooltip:!0},__source:{fileName:B,lineNumber:284,columnNumber:9}},null!=e?e:"-")}},{title:Object(F.g)("镜像列表"),dataIndex:"image_list",width:198,render:function(e){return null!=e&&e.length?g.a.createElement(E.a,{items:e,__source:{fileName:B,lineNumber:293,columnNumber:49}}):"-"}},{title:Object(F.g)("只读挂载列表"),dataIndex:"read_only_mount_list",width:198,render:function(e){return null!=e&&e.length?g.a.createElement(E.a,{items:e,__source:{fileName:B,lineNumber:299,columnNumber:49}}):"-"}},{title:Object(F.g)("读写挂载列表"),dataIndex:"read_write_mount_list",width:198,render:function(e){return null!=e&&e.length?g.a.createElement(E.a,{items:e,__source:{fileName:B,lineNumber:305,columnNumber:49}}):"-"}},{title:Object(F.g)("创建时间"),dataIndex:"create_time",width:110,render:function(e){if(e){var t=x.a.unix(e).format("YYYY-MM-DD HH:mm:ss").split(" ");return g.a.createElement("div",{__source:{fileName:B,lineNumber:318,columnNumber:13}},g.a.createElement("div",{__source:{fileName:B,lineNumber:319,columnNumber:15}},t[0]),g.a.createElement("div",{__source:{fileName:B,lineNumber:320,columnNumber:15}},t[1]))}return"-"}},{title:Object(F.g)("操作"),dataIndex:"operation",fixed:"right",width:74,render:function(e,t){return g.a.createElement(u.a,{onClick:function(){return re(t.threatres_id)},__source:{fileName:B,lineNumber:333,columnNumber:9}},Object(F.g)("数据"))}}],ne=Object(S.b)({columns:p?ae.slice(1):ae,whiteList:[Object(F.g)("集群"),Object(F.g)("风险名称"),Object(F.g)("操作")]}),ie=ne.selectedColumns,le=ne.scrollX,ue=ne.selectorProps;return g.a.createElement(w.a,{title:Object(F.g)("威胁资源"),containerStyle:p?{minWidth:"1200px",maxWidth:"85%",flexGrow:1}:{},__source:{fileName:B,lineNumber:344,columnNumber:5}},g.a.createElement("div",{className:Y("util-container"),__source:{fileName:B,lineNumber:348,columnNumber:7}},g.a.createElement("div",{__source:{fileName:B,lineNumber:349,columnNumber:9}},g.a.createElement(I.a,{placeholder:[Object(F.g)("创建时间"),Object(F.g)("创建时间")],value:U.create_time_start&&U.create_time_end?[x.a.unix(Number(U.create_time_start)),x.a.unix(Number(U.create_time_end))]:void 0,onChange:function(e,t){A({create_time_start:t?+String(t[0].unix()).slice(0,10):void 0,create_time_end:t?+String(t[1].unix()).slice(0,10):void 0})},__source:{fileName:B,lineNumber:350,columnNumber:11}})),g.a.createElement("div",{__source:{fileName:B,lineNumber:368,columnNumber:9}},g.a.createElement(y.a,{onRefresh:m()(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:i.a.success(Object(F.g)("刷新成功"));case 3:case"end":return e.stop()}}),e)}))),__source:{fileName:B,lineNumber:369,columnNumber:11}}),g.a.createElement(S.a,n()({},ue,{__source:{fileName:B,lineNumber:375,columnNumber:11}})))),g.a.createElement(R.a,{options:[{text:Object(F.g)("集群名称"),value:"cluster_name"},{text:Object(F.g)("所在区域"),value:"region"},{text:Object(F.g)("来源IP"),value:"source_ip"},{text:"UserAgent",value:"user_agent"},{text:Object(F.g)("用户"),value:"user"},{text:Object(F.g)("用户组"),value:"user_group"},{text:Object(F.g)("来源PSM"),value:"source_psm"},{text:Object(F.g)("资源类型"),value:"resource_kind"},{text:Object(F.g)("资源命名空间"),value:"resource_namespace"},{text:Object(F.g)("资源名"),value:"resource_name"},{text:Object(F.g)("镜像名称"),value:"image_name"},{text:Object(F.g)("只读挂载"),value:"read_only_mount"},{text:Object(F.g)("读写挂载"),value:"read_write_mount"},{text:Object(F.g)("集群ID"),value:"cluster_id"}],style:{marginBottom:16},value:U,onChange:function(e,t){return A(t)},__source:{fileName:B,lineNumber:378,columnNumber:7}}),g.a.createElement(P.a,n()({scroll:{x:le},columns:ie,rowKey:"threatres_id"},W(J),{__source:{fileName:B,lineNumber:399,columnNumber:7}})),g.a.createElement(h.a,{visible:q,value:ee,onOk:function(){Q(!1)},onCancel:function(){Q(!1)},title:Object(F.g)("原始数据"),__source:{fileName:B,lineNumber:405,columnNumber:7}}))}}}]);