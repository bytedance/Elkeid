(window.webpackJsonp=window.webpackJsonp||[]).push([[154,380,381],{1438:function(e,t,r){e.exports={container:"container-bfa68d5f1b","spin-container":"spin-container-12cffeeac5",header:"header-c347768b7d","item-title":"item-title-2132b929c5","detect-container":"detect-container-4f4fec8173","no-detect":"no-detect-ab81b2e241","state-container":"state-container-e97a1741d5",divider:"divider-d0b8f26de9","result-container":"result-container-f7ad7e17f6","total-container":"total-container-7db0de924b",percent:"percent-37fd6cefae"}},1514:function(e,t,r){e.exports={"group-container":"group-container-eba5422a70","detecting-drawer":"detecting-drawer-580b237548"}},1616:function(e,t,r){"use strict";r(803);var n=r(227),a=r(10),c=r.n(a),u=r(0),i=r.n(u),o="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/components/common/ellipsis-box/index.tsx";function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.a=function(e){var t=e.content,r=e.style,a=e.className,c=e.tooltipProps;return i.a.createElement(n.a.Paragraph,{className:a,style:s({marginBottom:0},r),ellipsis:{rows:1,showTooltip:{type:"tooltip",props:s(s({},c),{},{content:i.a.createElement("span",{style:{wordBreak:"break-all"},__source:{fileName:o,lineNumber:22,columnNumber:22}},t)})}},key:t,__source:{fileName:o,lineNumber:13,columnNumber:5}},t)}},443:function(e,t,r){"use strict";r.r(t);r(200);var n=r(85),a=(r(1400),r(1399)),c=(r(1337),r(1338)),u=(r(162),r(67)),i=(r(116),r(42)),o=r(28),l=r.n(o),s=r(16),m=r.n(s),b=r(0),p=r.n(b),d=r(115),f=r.n(d),N=r(52),_=r(1691),v=r(196),g=r(1619),h=r(811),O=r(1617),y=r(1608),j=r(12),E=r(1665),w=r(145),x=r(1438),k=r.n(x),D="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/pages/baseline-detect/overview-header/index.tsx",P=f.a.bind(k.a),S=p.a.forwardRef((function(e,t){var r=Object(N.f)(w.l),o=e.lastDetectTime,s=e.onProgressDetail,d=Object(b.useContext)(h.BaselineDetectCtx),f=d.policyGroupId,x=d.neverDetect,k=d.handleBaselineDetect,S=d.taskIsDetecting,I=d.progress,T=d.handleDetectSuccess,B=d.loadingPostBaselineDetect,C=d.loadingDetectCondition,R=d.baselineType,F=Object(h.useDetectingTransferFinish)().isTransferDetectStatus,G=Object(E.a)(l()(m.a.mark((function e(){var t,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(O.e)({params:{group_id:f}});case 2:if(t=e.sent,r=t.data.status,!F({detectStatus:r,policyGroupId:f})){e.next=7;break}return e.next=7,T("overviewHeader");case 7:return e.abrupt("return",t.data);case 8:case"end":return e.stop()}}),e)}))),{ready:Number.isFinite(f),auto:!0,refreshDeps:[f],pollingInterval:h.POLLING_INTERVAL_TIME,onSuccess:function(e,t,r){var n=e.status;Object(h.isDetectingStatus)(n)||r()}}),L=G.data,z=G.refresh,H=G.run,M=G.loading,A=G.error,J=null!=L?L:{},V=J.host_num,U=void 0===V?0:V,W=J.pass_rate,q=void 0===W?100:W,K=J.checklist_num,Q=void 0===K?0:K;return Object(b.useImperativeHandle)(t,(function(){return{refresh:z,reset:H}})),p.a.createElement(v.a,{error:A,errorStyle:{marginTop:6},displayType:v.b.element,spin:{className:P("spin-container")},__source:{fileName:D,lineNumber:100,columnNumber:5}},p.a.createElement(_.a,{title:Object(j.g)("基线概览"),className:P("container"),style:{color:"#000000"},titleStyle:{marginBottom:20},__source:{fileName:D,lineNumber:108,columnNumber:7}},p.a.createElement(n.a,{className:P("spin-container"),loading:M||C,__source:{fileName:D,lineNumber:114,columnNumber:9}},p.a.createElement("div",{className:P("header"),__source:{fileName:D,lineNumber:118,columnNumber:11}},p.a.createElement("div",{__source:{fileName:D,lineNumber:119,columnNumber:13}},p.a.createElement("div",{className:P("item-title"),__source:{fileName:D,lineNumber:120,columnNumber:15}},Object(j.g)("最近检查时间（每隔一日自动检查）")),p.a.createElement("div",{className:P("detect-container"),__source:{fileName:D,lineNumber:121,columnNumber:15}},x?p.a.createElement("span",{className:P("no-detect"),__source:{fileName:D,lineNumber:124,columnNumber:19}},Object(j.g)("暂未检查")):S?p.a.createElement(g.b,{progress:I,label:Object(j.g)("正在检查中"),className:P("state-container"),__source:{fileName:D,lineNumber:126,columnNumber:19}}):p.a.createElement("span",{className:P("state-container"),__source:{fileName:D,lineNumber:132,columnNumber:19}},Object(y.a)(o)),S&&!x?p.a.createElement(i.a,{type:"primary",onClick:s,__source:{fileName:D,lineNumber:136,columnNumber:19}},Object(j.g)("查看进度")):p.a.createElement(u.a,{disabled:r,content:Object(j.g)("当前用户无编辑权限"),__source:{fileName:D,lineNumber:140,columnNumber:19}},p.a.createElement(i.a,{disabled:!r,type:"primary",onClick:k,loading:B,__source:{fileName:D,lineNumber:141,columnNumber:21}},Object(j.g)("立即检查"))))),p.a.createElement(c.a,{type:"vertical",className:P("divider"),__source:{fileName:D,lineNumber:153,columnNumber:13}}),p.a.createElement("div",{className:P("result-container"),__source:{fileName:D,lineNumber:154,columnNumber:13}},p.a.createElement("div",{className:P("total-container"),__source:{fileName:D,lineNumber:155,columnNumber:15}},p.a.createElement("span",{__source:{fileName:D,lineNumber:156,columnNumber:17}},Object(j.g)("最近检查通过率")),p.a.createElement(v.c,{__source:{fileName:D,lineNumber:157,columnNumber:17}},x?p.a.createElement("span",{__source:{fileName:D,lineNumber:159,columnNumber:21}},"-"):p.a.createElement(a.a,{value:q,suffix:"%",countUp:!0,countFrom:100,__source:{fileName:D,lineNumber:161,columnNumber:21}}))),p.a.createElement("div",{className:P("total-container"),__source:{fileName:D,lineNumber:165,columnNumber:15}},p.a.createElement("span",{__source:{fileName:D,lineNumber:166,columnNumber:17}},Object(j.g)("kube"===R?"检查节点数":"检查主机数")),p.a.createElement("span",{__source:{fileName:D,lineNumber:167,columnNumber:17}},p.a.createElement(v.c,{__source:{fileName:D,lineNumber:168,columnNumber:19}},U))),p.a.createElement("div",{className:P("total-container"),__source:{fileName:D,lineNumber:171,columnNumber:15}},p.a.createElement("span",{__source:{fileName:D,lineNumber:172,columnNumber:17}},Object(j.g)("检查项")),p.a.createElement("span",{__source:{fileName:D,lineNumber:173,columnNumber:17}},p.a.createElement(v.c,{__source:{fileName:D,lineNumber:174,columnNumber:19}},Q))))))))}));t.default=S},509:function(e,t,r){"use strict";r.r(t);r(224);var n=r(97),a=(r(1294),r(1295)),c=r(50),u=r.n(c),i=r(28),o=r.n(i),l=(r(600),r(198)),s=r(16),m=r.n(s),b=r(0),p=r.n(b),d=r(55),f=r(1292),N=r(100),_=r(115),v=r.n(_),g=r(1616),h=r(1663),O=r(485),y=r(811),j=r(486),E=r(443),w=r(1617),x=r(12),k=r(1667),D=r(1514),P=r.n(D),S="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/pages/baseline-detect/index.tsx",I=v.a.bind(P.a),T=l.a.Option;t.default=function(e){var t=e.agentId,r=Object(d.h)().pathname.startsWith("/kube")?"kube":"host",c=Object(b.useRef)(null),i=Object(b.useRef)(null),s=Object(b.useRef)(null),_=Object(f.a)(o()(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.c)();case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)}))),{ready:"host"===r,auto:!0}).data,v=Object(b.useMemo)((function(){var e;return null!==(e=null==_?void 0:_.map((function(e){return{label:e.group_name,value:e.group_id}})))&&void 0!==e?e:[]}),[_]),D=Object(b.useState)("kube"===r?10:void 0),P=u()(D,2),B=P[0],C=P[1];Object(b.useEffect)((function(){var e;_&&C(null===(e=_[0])||void 0===e?void 0:e.group_id)}),[_]);var R=Object(y.useDetectingTransferFinish)().isTransferDetectStatus,F=Object(k.a)(o()(m.a.mark((function e(){var t,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.d)({params:{group_id:B}});case 2:if(t=e.sent,r=t.data.status,!R({detectStatus:r,policyGroupId:B})){e.next=7;break}return e.next=7,ne("baselineDetect");case 7:return e.abrupt("return",t.data);case 8:case"end":return e.stop()}}),e)}))),{auto:!0,ready:Number.isFinite(B),refreshDeps:[B],pollingInterval:y.POLLING_INTERVAL_TIME,onSuccess:function(e,t,r){var n=e.status;Object(y.isDetectingStatus)(n)||r()}}),G=F.data,L=F.refresh,z=F.loading,H=null!=G?G:{},M=H.last_check_time,A=H.progress,J=H.status,V=0===M&&0===A&&J===w.b.finished,U=Object(y.isDetectingStatus)(J),W=function(){var e=o()(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([null===(t=c.current)||void 0===t?void 0:t.refresh(),L()]);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=Object(b.useState)(!1),K=u()(q,2),Q=K[0],X=K[1],Y=Object(f.a)(o()(m.a.mark((function e(){var t,r,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.i)({data:{group_id:B,if_all_host:!0}});case 2:if((t=e.sent).data.status!==w.r.success){e.next=11;break}return e.prev=4,e.next=7,Promise.all([L(),null===(r=i.current)||void 0===r?void 0:r.reset(),null===(n=c.current)||void 0===n?void 0:n.reset()]);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:return e.abrupt("return",t.data);case 12:case"end":return e.stop()}}),e,null,[[4,9]])}))),{ready:Number.isFinite(B),throwOnError:!0}),Z=Y.run,$=Y.loading,ee=Object(b.useRef)(!0);function te(){return(te=o()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$){e.next=2;break}return e.abrupt("return");case 2:return ee.current=!0,e.prev=3,e.next=6,Z();case 6:X(!0),n.a.info(Object(x.g)("已开始基线检查")),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function re(){return(re=o()(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(w.i)({data:t});case 3:e.sent.data.status===w.r.success&&n.a.info(Object(x.g)("已开始基线检查")),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function ne(e){return ae.apply(this,arguments)}function ae(){return(ae=o()(m.a.mark((function e(t){var r,a,u,o,l,b;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ee.current){e.next=2;break}return e.abrupt("return");case 2:return ee.current=!1,a=[],"baselineTable"!==t&&a.push(null===(u=i.current)||void 0===u?void 0:u.refresh()),"overviewHeader"!==t&&a.push(null===(o=c.current)||void 0===o?void 0:o.refresh()),"baselineDetect"!==t&&a.push(L()),"detectingOverview"!==t&&a.push(null===(l=s.current)||void 0===l?void 0:l.refresh()),e.next=10,Promise.all(a);case 10:b=null===(r=v.find((function(e){return e.value===B})))||void 0===r?void 0:r.label,n.a.success(b?"".concat(Object(x.g)("“{groupName}”基线检查完成",{groupName:b})):Object(x.g)("基线检查完成"));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(){return(ce=o()(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([null===(t=c.current)||void 0===t?void 0:t.refresh()]);case 2:n.a.success(Object(x.g)("检查完成"));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(N.a)((function(){ee.current=!0}),[B]),G?p.a.createElement(y.BaselineDetectCtx.Provider,{value:{policyGroupId:B,policyDetectStatus:null==G?void 0:G.status,loadingPostBaselineDetect:$,taskIsDetecting:U,neverDetect:V,handleBaselineDetect:function(){return te.apply(this,arguments)},handleDetectSuccess:ne,handleSomeDetect:function(e){return re.apply(this,arguments)},progress:null==G?void 0:G.progress,loadingDetectCondition:z,baselineType:r},__source:{fileName:S,lineNumber:241,columnNumber:5}},p.a.createElement("div",{className:"container",style:{display:"grid",gridTemplateRows:"kube"===r?"auto 1fr":"auto auto 1fr"},__source:{fileName:S,lineNumber:256,columnNumber:7}},"host"===r&&p.a.createElement("div",{className:I("group-container"),__source:{fileName:S,lineNumber:264,columnNumber:11}},p.a.createElement("span",{__source:{fileName:S,lineNumber:265,columnNumber:13}},Object(x.g)("基线检查策略组：")),p.a.createElement(l.a,{style:{width:180},value:B,onChange:C,options:v,__source:{fileName:S,lineNumber:266,columnNumber:13}},null==v?void 0:v.map((function(e){return p.a.createElement(T,{value:e.value,key:e.value,__source:{fileName:S,lineNumber:273,columnNumber:17}},p.a.createElement(g.a,{style:{whiteSpace:"pre-wrap",wordBreak:"break-all",display:"inline-block"},key:e.value,content:e.label,tooltipProps:{position:"bottom"},__source:{fileName:S,lineNumber:274,columnNumber:19}}))})))),p.a.createElement(E.default,{lastDetectTime:G.last_check_time,onProgressDetail:function(){return X(!0)},ref:c,__source:{fileName:S,lineNumber:291,columnNumber:9}}),p.a.createElement(O.default,{onRefresh:W,onSomeBaselineDetectSuccess:function(){return ce.apply(this,arguments)},agentId:t,ref:i,__source:{fileName:S,lineNumber:296,columnNumber:9}}),p.a.createElement(a.a,{visible:Q,onCancel:function(){return X(!1)},width:400,closable:!1,unmountOnExit:!0,footer:null,title:null,maskStyle:{backgroundColor:"rgba(255, 255, 255, 0)"},getPopupContainer:function(){return document.getElementById("content-root")},className:I("detecting-drawer"),__source:{fileName:S,lineNumber:302,columnNumber:9}},p.a.createElement(j.default,{ref:s,onClose:function(){return X(!1)},__source:{fileName:S,lineNumber:316,columnNumber:11}})))):p.a.createElement(h.a,{__source:{fileName:S,lineNumber:237,columnNumber:12}})}}}]);