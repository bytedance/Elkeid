(window.webpackJsonp=window.webpackJsonp||[]).push([[127,9,430],{1421:function(e,t,n){e.exports={intro:"intro-2698715505",title:"title-5035c98ace","steps-container":"steps-container-13987455b7",steps:"steps-b6f547d28b","step-text":"step-text-b726eb401b",header:"header-478b68fc2d"}},1703:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return i})),n.d(t,"g",(function(){return m})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return b})),n.d(t,"b",(function(){return s}));var r,a=n(54),l=n(12);function u(e,t){return Object(a.b)({url:"/api/v6/kube/GetConfigList",params:e,data:t,method:"POST"},Object(l.g)("获取容器集群配置列表"))}function c(e){return Object(a.b)({url:"/api/v6/kube/AddConfig",data:e,method:"POST"},Object(l.g)("添加集群"))}function i(e){return Object(a.b)({url:"/api/v6/kube/DelConfig",data:e,method:"POST"},Object(l.g)("取消集群链接"))}function m(e){return Object(a.b)({url:"/api/v6/kube/RenameConfig",data:e,method:"POST"},Object(l.g)("重命名集群"))}function o(){return Object(a.b)({url:"/api/v6/kube/PolicyDownload",method:"GET",responseType:"blob"},Object(l.g)("集群policy文件下载"),!1,!1)}function b(e){return Object(a.b)({url:"/api/v6/kube/WebhookDownload",params:e,method:"GET",responseType:"blob"},Object(l.g)("集群webhook文件下载"))}function s(){return Object(a.b)({url:"/api/v6/kube/KubeCreateShDownload",method:"GET",responseType:"blob"},Object(l.g)("k8s创建kube脚本文件下载"))}!function(e){e["正常运行"]="active",e["未安装"]="inactive",e["异常"]="error",e["安装失败"]="install_fail",e.active="正常运行",e.inactive="未安装",e.error="异常",e.install_fail="安装失败"}(r||(r={}))},1718:function(e,t,n){"use strict";t.a=function(e,t){var n,r=new Set,a={},l=[];Object.keys(t).forEach((function(t){var n=new RegExp("\\{".concat(t,"\\}"),"g"),l=Array.from(null==e?void 0:e.matchAll(n));null==l||l.forEach((function(e){var n=e.index;(function(e,t){for(;e<t;){if(r.has(e))return!0;e++}return!1})(n,n+t.length+2)||(!function(e,t){for(;e<t;)r.add(e),e++}(n,n+t.length+2),a[n]=t)}))}));for(var u=0;u<e.length;){var c,i=a[u];if(i)n&&(l.push(n),n=void 0),l.push(null===(c=t[i])||void 0===c?void 0:c.call(t)),u+=i.length+2;else n=(n||"")+e[u],u++}return n&&l.push(n),l}},1749:function(e,t,n){"use strict";var r=n(0),a=n.n(r),l=n(115),u=n.n(l),c=n(1755),i=n.n(c),m="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/components/common/readonly-code-block/index.tsx",o=u.a.bind(i.a);t.a=function(e){var t=e.code,n=e.highlights,r=void 0===n?[]:n,l=e.style,u=void 0===l?{}:l,c=new Set(r),i="string"==typeof t?t.split("\n").map((function(e,t){return{code:e,style:{background:c.has(t+1)?"#E8F4FF":void 0}}})):t.map((function(e){return"string"==typeof e?{code:e}:e}));return a.a.createElement("div",{className:o("container"),style:u,__source:{fileName:m,lineNumber:32,columnNumber:5}},a.a.createElement("div",{className:o("lines-gutter"),__source:{fileName:m,lineNumber:33,columnNumber:7}},i.map((function(e,t){return a.a.createElement("p",{key:t,__source:{fileName:m,lineNumber:35,columnNumber:11}},t+1)}))),a.a.createElement("div",{className:o("code-container"),__source:{fileName:m,lineNumber:38,columnNumber:7}},i.map((function(e,t){var n=e.code,r=e.style,l=void 0===r?{}:r;return a.a.createElement("code",{key:t,style:l,__source:{fileName:m,lineNumber:40,columnNumber:11}},n)}))))}},1755:function(e,t,n){e.exports={container:"container-f62ec6cf8a","lines-gutter":"lines-gutter-31fdc2c602","code-container":"code-container-cf098acda3"}},1761:function(e,t,n){e.exports={content:"content-f03b5e1c31","content-visible":"content-visible-8ba56802a6",title:"title-4c5e0a7931","title-expandable":"title-expandable-c67a1631f1",container:"container-b5d34023e3",arrow:"arrow-5d79347e39","arrow-expanded":"arrow-expanded-3a0e120555"}},391:function(e,t,n){"use strict";n.r(t);n(1294);var r,a=n(1295),l=(n(1337),n(1338)),u=(n(1296),n(1297)),c=(n(299),n(165)),i=(n(803),n(227)),m=n(0),o=n.n(m),b=n(115),s=n.n(b),N=n(50),f=n.n(N);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var _=function(e){return o.a.createElement("svg",d({width:5,height:8,fill:"none"},e),r||(r=o.a.createElement("path",{d:"M1.648 6.85A1 1 0 010 6.088V1.912a1 1 0 011.648-.761l2.456 2.087a1 1 0 010 1.524L1.648 6.85z",fill:"#86909C"})))},p=n(1761),g=n.n(p),E="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/components/common/expandable-content-block/index.tsx",v=s.a.bind(g.a),h=function(e){var t=e.title,n=e.children,r=e.titleStyle,a=e.contentStyle,l=e.containerStyle,u=Object(m.useState)(!1),c=f()(u,2),i=c[0],b=c[1];return o.a.createElement("div",{className:v("container"),style:l,__source:{fileName:E,lineNumber:27,columnNumber:5}},o.a.createElement("div",{className:v("title",n&&"title-expandable"),onClick:function(){return b(!i)},__source:{fileName:E,lineNumber:28,columnNumber:7}},n&&o.a.createElement("div",{className:v("arrow",i&&"arrow-expanded"),style:r,__source:{fileName:E,lineNumber:33,columnNumber:11}},o.a.createElement(_,{__source:{fileName:E,lineNumber:34,columnNumber:13}})),t),o.a.createElement("div",{className:v("content",i&&"content-visible"),style:a,__source:{fileName:E,lineNumber:39,columnNumber:7}},n))},O=n(1749),k=n(1703),y=n(12),j=n(1718),w=n(1421),x=n.n(w),S="/opt/tiger/compile_path/src/code.byted.org/biz-platform/hids/src/pages/kube-config/installation-guide-drawer/index.tsx",P=s.a.bind(x.a);t.default=function(e){var t=e.onClose,n=e.visible,r=e.clusterId,m=e.disableDownload,b=void 0!==m&&m;return o.a.createElement(a.a,{footer:null,title:o.a.createElement("div",{className:P("header"),__source:{fileName:S,lineNumber:30,columnNumber:14}},Object(y.g)("插件安装指引")),width:640,bodyStyle:{padding:0},headerStyle:{height:56},visible:n,onCancel:t,__source:{fileName:S,lineNumber:28,columnNumber:5}},o.a.createElement("div",{className:P("intro"),__source:{fileName:S,lineNumber:37,columnNumber:7}},o.a.createElement(i.a.Paragraph,{style:{marginBottom:0},__source:{fileName:S,lineNumber:38,columnNumber:9}},o.a.createElement("ol",{style:{lineHeight:"22px"},__source:{fileName:S,lineNumber:39,columnNumber:11}},o.a.createElement("li",{__source:{fileName:S,lineNumber:40,columnNumber:13}},Object(y.g)("本系统基于 Kubernetes 的 Audit Logs 实现了容器集群的入侵检测 & 威胁分析；")),o.a.createElement("li",{__source:{fileName:S,lineNumber:43,columnNumber:13}},Object(y.g)("启用此安全组件的前置条件是：正确配置 Kubernetes 的 Auditing 功能，并采集 Audit Logs 到系统后端；")),o.a.createElement("li",{__source:{fileName:S,lineNumber:48,columnNumber:13}},Object(y.g)("由于 Dynamic Backend 类型的配置方式已从 Kubernetes v1.19 开始移除，且客户环境多样，因此本系统暂不支持 Kubernetes Audit Logs 功能的自动配置；")),o.a.createElement("li",{__source:{fileName:S,lineNumber:53,columnNumber:13}},Object(y.g)("请按照以下方式进行手动配置，从而启用/关闭本系统的入侵检测 & 威胁分析功能。"))))),o.a.createElement("div",{className:P("steps-container"),__source:{fileName:S,lineNumber:59,columnNumber:7}},o.a.createElement("p",{className:P("title"),__source:{fileName:S,lineNumber:60,columnNumber:9}},Object(y.g)("开启步骤")),o.a.createElement(u.a,{direction:"vertical",current:0,className:P("steps"),__source:{fileName:S,lineNumber:61,columnNumber:9}},o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:o.a.createElement("div",{className:P("step-text"),__source:{fileName:S,lineNumber:66,columnNumber:19}},Object(y.g)("下载 audit policy file"),o.a.createElement(c.a,{style:{marginLeft:4},onClick:function(){return Object(k.c)().catch(console.log)},__source:{fileName:S,lineNumber:68,columnNumber:21}},Object(y.g)("点击下载"))),__source:{fileName:S,lineNumber:64,columnNumber:15}}),__source:{fileName:S,lineNumber:62,columnNumber:11}}),o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:o.a.createElement("div",{className:P("step-text"),__source:{fileName:S,lineNumber:84,columnNumber:19}},Object(y.g)("下载 audit webhook config file（仅限当前集群使用）"),o.a.createElement(c.a,{style:{marginLeft:4},onClick:function(){return Object(k.d)({cluster_id:r})},disabled:b,__source:{fileName:S,lineNumber:86,columnNumber:21}},Object(y.g)("点击下载"))),__source:{fileName:S,lineNumber:82,columnNumber:15}}),__source:{fileName:S,lineNumber:80,columnNumber:11}}),o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:Object(y.g)("将上述文件拷贝到集群的所有 Master 节点中"),__source:{fileName:S,lineNumber:104,columnNumber:15}},Object(y.g)("例如："),o.a.createElement("br",{__source:{fileName:S,lineNumber:106,columnNumber:17}}),Object(j.a)(Object(y.g)("将{filename}拷贝至{path}"),{filename:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:108,columnNumber:35}},"audit webhook config file")},path:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:109,columnNumber:31}},"/etc/kubernetes/elkeid-audit/audit.kubeconfig")}}),o.a.createElement("br",{__source:{fileName:S,lineNumber:111,columnNumber:17}}),Object(j.a)(Object(y.g)("将{filename}拷贝至{path}"),{filename:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:113,columnNumber:35}},"audit policy file")},path:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:114,columnNumber:31}},"/etc/kubernetes/elkeid-audit/audit-policy.yaml")}})),__source:{fileName:S,lineNumber:102,columnNumber:11}}),o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:Object(y.g)("修改集群所有 Master 节点的 apiserver 配置"),containerStyle:{width:533},__source:{fileName:S,lineNumber:121,columnNumber:15}},o.a.createElement(i.a.Paragraph,{style:{color:"#86909C",wordBreak:"break-word"},__source:{fileName:S,lineNumber:125,columnNumber:17}},o.a.createElement("ol",{__source:{fileName:S,lineNumber:126,columnNumber:19}},o.a.createElement("li",{__source:{fileName:S,lineNumber:127,columnNumber:21}},Object(j.a)(Object(y.g)("若使用本地服务方式部署{apiserver}。那么请修改对应的服务配置文件；"),{apiserver:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:130,columnNumber:44}},"apiserver")}})),o.a.createElement("li",{__source:{fileName:S,lineNumber:133,columnNumber:21}},Object(j.a)(Object(y.g)("若使用{1}方式部署{2}，那么请修改{3}。"),{1:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:135,columnNumber:34}},"static pod")},2:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:136,columnNumber:34}},"apiserver")},3:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:137,columnNumber:34}},"/etc/kubernetes/manifests/kube-apiserver.yaml")}}),o.a.createElement("br",{__source:{fileName:S,lineNumber:139,columnNumber:23}}),Object(y.g)("例如增加如下标蓝的内容：")))),o.a.createElement(O.a,{highlights:[18,19,22,23,24,30,31,32,33],code:"apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    component: kube-apiserver\n    tier: control-plane\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  containers:\n  - name: kube-apiserver\n    image: k8s.gcr.io/kube-apiserver:v1.20.7\n    imagePullPolicy: IfNotPresent\n    ...\n    command:\n    - kube-apiserver\n    ...\n    - --audit-policy-file=/etc/kubernetes/audit/audit-policy.yaml\n    - --audit-webhook-config-file=/etc/kubernetes/audit/audit.kubeconfig\n    volumeMounts:\n    ...\n    - mountPath: /etc/kubernetes/audit/\n      name: elkeid-audit\n      readOnly: true\n  hostNetwork: true\n  priorityClassName: system-node-critical\n  ...\n  volumes:\n  ...\n  - hostPath:\n      path: /etc/kubernetes/elkeid-audit\n      type: Directory\n    name: elkeid-audit",__source:{fileName:S,lineNumber:144,columnNumber:17}})),__source:{fileName:S,lineNumber:119,columnNumber:11}}),o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:Object(y.g)("重启 apiserver"),containerStyle:{width:534},__source:{fileName:S,lineNumber:185,columnNumber:15}},o.a.createElement(i.a.Paragraph,{style:{color:"#86909C",lineHeight:"20px",wordBreak:"break-word"},__source:{fileName:S,lineNumber:189,columnNumber:17}},o.a.createElement("ol",{__source:{fileName:S,lineNumber:192,columnNumber:19}},o.a.createElement("li",{__source:{fileName:S,lineNumber:193,columnNumber:21}},Object(j.a)(Object(y.g)("请逐个重启集群的{1}；"),{1:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:195,columnNumber:34}},"apiserver")}})),o.a.createElement("li",{__source:{fileName:S,lineNumber:198,columnNumber:21}},Object(j.a)(Object(y.g)("若使用{1}方式部署{2}（例如通过{3}创建的集群）： 一般情况下，当 kubelet 检测到{4}的{5}文件发送变更时{6}会自动重新启动{7}； 若{8}未发生重启，可以通过移动并恢复{9}文件的方式触发重启。"),{1:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:204,columnNumber:36}},"static pod")},2:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:205,columnNumber:36}},"apiserver")},3:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:206,columnNumber:36}},"kubeadm")},4:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:207,columnNumber:36}},"apiserver")},5:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:208,columnNumber:36}},"YAML")},6:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:209,columnNumber:36}},"kubelet")},7:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:210,columnNumber:36}},"apiserver static pod")},8:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:211,columnNumber:36}},"apiserver static pod")},9:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:212,columnNumber:36}},"apiserver YAML")}})),o.a.createElement("li",{__source:{fileName:S,lineNumber:216,columnNumber:21}},Object(j.a)(Object(y.g)("若使用本地服务方式部署{1}，请手动重启对应的服务。"),{1:function(){return o.a.createElement("span",{__source:{fileName:S,lineNumber:220,columnNumber:36}},"apiserver")}}))))),__source:{fileName:S,lineNumber:183,columnNumber:11}})),o.a.createElement(l.a,{style:{margin:"20px 0"},__source:{fileName:S,lineNumber:230,columnNumber:9}}),o.a.createElement("p",{className:P("title"),__source:{fileName:S,lineNumber:231,columnNumber:9}},Object(y.g)("关闭步骤")),o.a.createElement(u.a,{direction:"vertical",current:0,className:P("steps"),__source:{fileName:S,lineNumber:232,columnNumber:9}},o.a.createElement(u.a.Step,{title:o.a.createElement(h,{containerStyle:{width:534},title:Object(y.g)("修改集群所有 master 节点的 apiserver 配置文件，删除“开启步骤”中的 Kubernetes Auditing 相关配置"),__source:{fileName:S,lineNumber:235,columnNumber:15}}),__source:{fileName:S,lineNumber:233,columnNumber:11}}),o.a.createElement(u.a.Step,{title:o.a.createElement(h,{title:Object(y.g)("重启 apiserver"),__source:{fileName:S,lineNumber:243,columnNumber:30}}),__source:{fileName:S,lineNumber:243,columnNumber:11}}))))}}}]);